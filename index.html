<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GPA Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f6f8fa; margin: 0; padding: 30px; color: #222; }
    h1 { text-align: center; font-size: 2rem; margin-bottom: 1em; }
    .container { display: flex; gap: 30px; overflow-x: auto; margin-bottom: 30px; }
    .semester { background: #fff; border-radius: 8px; box-shadow: 0 2px 6px #d4d4d4; padding: 20px; min-width: 240px; display: flex; flex-direction: column; }
    .semester-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 12px; text-align: center; position: relative; }
    .courses { margin-bottom: 16px; }
    .course { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    select { font-size: 1rem; padding: 2px 5px; border-radius: 4px; }
    .add-btn, .add-semester-btn, .remove-btn { background: #0053ba; color: #fff; border: none; border-radius: 4px; padding: 4px 12px; font-size: 1rem; cursor: pointer; }
    .add-btn:hover, .add-semester-btn:hover, .remove-btn:hover { background: #003599; }
    .remove-btn.small { padding: 2px 8px; font-size: 0.9rem; }
    .gpa-row { font-weight: bold; margin: 6px 0 0; border-top: 1px solid #eaeaea; padding-top: 8px; text-align: center; font-size: 1.05rem; }
    .cumulative { margin-top: 20px; text-align: center; font-size: 1.15rem; font-weight: bold; }
    .actions { text-align: center; margin-bottom: 22px; }
    @media(max-width: 800px) {
      .container { flex-direction: column; gap: 18px; }
      .semester { width: 100%; }
    }
  </style>
</head>
<body>
  <h1>GPA Calculator</h1>
  <div class="actions">
    <button id="add-semester-btn" class="add-semester-btn">Add Semester</button>
  </div>
  <div class="container" id="semesters"></div>
  <div class="cumulative">
    Cumulative GPA: <span id="cumulativeGPA">0.00</span>
  </div>

  <script>
    (function () {
      // Defensive coding + helpful console logs
      console.log('GPA Calculator script loaded');

      const gradeOptions = [
        { label: "A+", value: 4.0 },
        { label: "A",  value: 3.75 },
        { label: "B+", value: 3.5 },
        { label: "B",  value: 3.0 },
        { label: "C+", value: 2.5 },
        { label: "C",  value: 2.0 },
        { label: "D+", value: 1.5 },
        { label: "D",  value: 1.0 },
        { label: "F",  value: 0.0 }
      ];
      const creditOptions = [1,2,3,4];

      let semesterCount = 0;
      let courseCounts = []; // holds number of courses per semester (starts at 0 for new semester)

      const semestersDiv = document.getElementById('semesters');
      const cumulativeEl = document.getElementById('cumulativeGPA');
      const addSemesterBtn = document.getElementById('add-semester-btn');

      // Public functions (exposed in closure; no reliance on global scope)
      function createSemesterElement(semNum) {
        const div = document.createElement('div');
        div.className = 'semester';
        div.id = `semester-${semNum}`;

        const title = document.createElement('div');
        title.className = 'semester-title';
        title.textContent = `Semester ${semNum}`;

        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'remove-btn small';
        removeBtn.title = 'Remove semester';
        removeBtn.textContent = '×';
        removeBtn.style.position = 'absolute';
        removeBtn.style.right = '10px';
        removeBtn.style.top = '6px';
        removeBtn.addEventListener('click', () => removeSemester(semNum));
        title.appendChild(removeBtn);

        const courses = document.createElement('div');
        courses.className = 'courses';
        courses.id = `courses-${semNum}`;

        const addCourseBtn = document.createElement('button');
        addCourseBtn.type = 'button';
        addCourseBtn.className = 'add-btn';
        addCourseBtn.textContent = 'Add Course';
        addCourseBtn.addEventListener('click', () => addCourse(semNum));

        const gpaRow = document.createElement('div');
        gpaRow.className = 'gpa-row';
        gpaRow.innerHTML = `Term GPA: <span id="termGPA-${semNum}">0.00</span>`;

        div.appendChild(title);
        div.appendChild(courses);
        div.appendChild(addCourseBtn);
        div.appendChild(gpaRow);

        return div;
      }

      function addSemester() {
        try {
          semesterCount++;
          courseCounts[semesterCount - 1] = 0; // start with zero courses; addCourse will increment
          const semEl = createSemesterElement(semesterCount);
          semestersDiv.appendChild(semEl);
          addCourse(semesterCount); // add first course automatically
          recalculateAll();
          console.log(`Added semester ${semesterCount}`);
        } catch (err) {
          console.error('Error in addSemester:', err);
        }
      }

      function removeSemester(semNum) {
        try {
          const el = document.getElementById(`semester-${semNum}`);
          if (el) el.remove();
          courseCounts[semNum - 1] = 0;
          recalculateAll();
          console.log(`Removed semester ${semNum}`);
        } catch (err) {
          console.error('Error in removeSemester:', err);
        }
      }

      function makeSelect(options, idPrefix, semNum, courseNum) {
        const sel = document.createElement('select');
        sel.id = `${idPrefix}-${semNum}-${courseNum}`;
        options.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt.value !== undefined ? opt.value : opt;
          o.textContent = opt.label !== undefined ? opt.label : opt;
          sel.appendChild(o);
        });
        sel.addEventListener('change', recalculateAll);
        return sel;
      }

      function addCourse(semNum) {
        try {
          const coursesDiv = document.getElementById(`courses-${semNum}`);
          if (!coursesDiv) return;
          const courseNum = ++courseCounts[semNum - 1]; // increment and use
          const courseDiv = document.createElement('div');
          courseDiv.className = 'course';
          courseDiv.id = `course-${semNum}-${courseNum}`;

          // Grade select
          const gradeLabel = document.createElement('label');
          gradeLabel.textContent = 'Grade ';
          const gradeSel = makeSelect(gradeOptions, 'grade', semNum, courseNum);
          gradeLabel.appendChild(gradeSel);

          // Credit select
          const creditLabel = document.createElement('label');
          creditLabel.textContent = ' Credits ';
          const creditSel = makeSelect(creditOptions, 'credit', semNum, courseNum);
          creditLabel.appendChild(creditSel);

          // Remove course button
          const removeBtn = document.createElement('button');
          removeBtn.type = 'button';
          removeBtn.className = 'remove-btn small';
          removeBtn.textContent = '−';
          removeBtn.title = 'Remove course';
          removeBtn.addEventListener('click', () => {
            courseDiv.remove();
            recalculateAll();
          });

          courseDiv.appendChild(gradeLabel);
          courseDiv.appendChild(creditLabel);
          courseDiv.appendChild(removeBtn);

          coursesDiv.appendChild(courseDiv);
          recalculateAll();
          console.log(`Added course ${courseNum} to semester ${semNum}`);
        } catch (err) {
          console.error('Error in addCourse:', err);
        }
      }

      function recalculateAll() {
        try {
          let totalPoints = 0, totalCredits = 0;
          for (let s = 1; s <= semesterCount; s++) {
            const coursesDiv = document.getElementById(`courses-${s}`);
            if (!coursesDiv) continue;
            const courseDivs = Array.from(coursesDiv.getElementsByClassName('course'));
            let termPoints = 0, termCredits = 0;
            courseDivs.forEach(div => {
              const gradeSel = div.querySelector('select[id^="grade-"]');
              const creditSel = div.querySelector('select[id^="credit-"]');
              if (gradeSel && creditSel) {
                const grade = parseFloat(gradeSel.value || 0);
                const credit = parseInt(creditSel.value || 0, 10);
                if (!isNaN(grade) && !isNaN(credit)) {
                  termPoints += grade * credit;
                  termCredits += credit;
                }
              }
            });
            const termGPA = termCredits ? (termPoints / termCredits) : 0;
            const termEl = document.getElementById(`termGPA-${s}`);
            if (termEl) termEl.innerText = termGPA.toFixed(2);
            totalPoints += termPoints;
            totalCredits += termCredits;
          }
          const cumulativeGPA = totalCredits ? (totalPoints / totalCredits) : 0;
          cumulativeEl.innerText = cumulativeGPA.toFixed(2);
        } catch (err) {
          console.error('Error in recalculateAll:', err);
        }
      }

      // Hook up top-level Add Semester button
      addSemesterBtn.addEventListener('click', addSemester);

      // Start with one semester
      document.addEventListener('DOMContentLoaded', () => {
        try {
          addSemester();
        } catch (err) {
          console.error('Error initializing page:', err);
        }
      });

      // Expose for debugging in console if you want:
      window._gpa = {
        addSemester, addCourse, removeSemester, recalculateAll
      };

    })();
  </script>
</body>
</html>
